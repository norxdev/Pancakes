<!DOCTYPE html>
<html>
<head>
    <title>OSRS Flipping Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 2.5rem;
        }

        .toggle-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 20px;
            flex-wrap: wrap;
        }

        .sort-select {
            padding: 8px 12px;
            border-radius: 5px;
            border: none;
            font-size: 1.1rem;
        }

        .container {
            max-width: 1000px;
            width: 95%;
            margin: 0 auto;
        }

        .overview {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .overview-item {
            background: #1e1e1e;
            border-radius: 10px;
            padding: 15px 20px;
            cursor: pointer;
            text-align: center;
            min-width: 180px;
            transition: background 0.3s;
        }

        .overview-item:hover {
            background: #333;
        }

        .overview-item span {
            display: block;
            font-weight: bold;
            font-size: 1.2rem;
            margin-top: 5px;
        }

        .set-wrapper {
            background: #1e1e1e;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.6);
        }

        .set-title {
            font-size: 1.8rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .cards {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .card {
            background: #2a2a2a;
            padding: 15px 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.3rem;
        }

        .card.total {
            font-weight: bold;
            font-size: 1.3rem;
        }

        .profit-box {
            background: #2a2a2a;
            border-radius: 10px;
            padding: 20px 15px;
            text-align: center;
            font-size: 1.4rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            margin-top: 10px;
        }

        .profit-box span {
            display: block;
            font-size: 1.8rem;
            font-weight: bold;
        }

        .profit-positive span {
            color: #00e676;
        }

        .profit-negative span {
            color: #ff3d00;
        }

        input[type="number"] {
            width: 70px;
            padding: 8px;
            border-radius: 5px;
            border: none;
            margin-left: 10px;
            text-align: center;
            font-size: 1.2rem;
        }

        label {
            font-weight: bold;
            font-size: 1.2rem;
        }

        button {
            padding: 8px 12px;
            margin-left: 10px;
            border-radius: 5px;
            border: none;
            background-color: #00e676;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.2rem;
        }

        button:hover {
            background-color: #00c853;
        }

        .item-icon {
            width: 50px;
            height: 50px;
            margin-right: 12px;
            image-rendering: pixelated;
        }

        .item-label {
            display: flex;
            align-items: center;
            font-size: 1.3rem;
        }

        footer {
            text-align: center;
            margin-top: 20px;
            color: #888;
            font-size: 14px;
        }

        @media (max-width: 800px) {
            .card {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .overview-item {
                min-width: 140px;
            }

            input[type="number"] {
                width: 60px;
            }
        }
    </style>
</head>
<body>
    <h1>OSRS Flipping Dashboard</h1>

    <div class="toggle-container">
        <div>
            <label>Sort by: </label>
            <select id="sortSelect" class="sort-select">
                <option value="profit">Profit per set</option>
                <option value="roi">ROI per set</option>
                <option value="cost">Total cost</option>
            </select>
        </div>
    </div>

    <div class="container">
        <div id="overview" class="overview"></div>
        <div id="setsContainer"></div>
    </div>

    <script>
        const setsData = [
            {
                name: "Sunfire Fanatic",
                items: [
                    {name: "Helm", id: "28933", imgName: "Sunfire_fanatic_helm"},
                    {name: "Cuirass", id: "28936", imgName: "Sunfire_fanatic_cuirass"},
                    {name: "Chausses", id: "28939", imgName: "Sunfire_fanatic_chausses"}
                ],
                setId: "29424",
                setImgName: "Sunfire_fanatic_armour_set"
            },
            {
                name: "Blood Moon",
                items: [
                    {name: "Chestplate", id: "29022", imgName: "Blood_moon_chestplate_detail"},
                    {name: "Helm", id: "29028", imgName: "Blood_moon_helm_detail"},
                    {name: "Tassets", id: "29025", imgName: "Blood_moon_tassets_detail"},
                    {name: "Dual Macuahuitl", id: "28997", imgName: "Dual_macuahuitl_detail"}
                ],
                setId: "31136",
                setImgName: "Blood_moon_armour_set_detail"
            },
            {
                name: "Blue Moon",
                items: [
                    {name: "Chestplate", id: "29013", imgName: "Blue_moon_chestplate_detail"},
                    {name: "Helm", id: "29019", imgName: "Blue_moon_helm_detail"},
                    {name: "Spear", id: "28988", imgName: "Blue_moon_spear_detail"},
                    {name: "Tassets", id: "29016", imgName: "Blue_moon_tassets_detail"}
                ],
                setId: "31139",
                setImgName: "Blue_moon_armour_set_detail"
            },
            {
                name: "Eclipse Moon",
                items: [
                    {name: "Chestplate", id: "29004", imgName: "Eclipse_moon_chestplate_detail"},
                    {name: "Helm", id: "29010", imgName: "Eclipse_moon_helm_detail"},
                    {name: "Tassets", id: "29007", imgName: "Eclipse_moon_tassets_detail"},
                    {name: "Atlatl", id: "29000", imgName: "Eclipse_atlatl_detail"}
                ],
                setId: "31142",
                setImgName: "Eclipse_moon_armour_set_detail"
            }
        ];

        let latestData = {};

        function formatNum(num) {
            return num.toLocaleString();
        }

        function createOverview() {
            const overviewEl = document.getElementById("overview");
            overviewEl.innerHTML = "";
            setsData.forEach((set, index) => {
                const profitPerSet = calculateProfit(set).profit;
                const div = document.createElement("div");
                div.className = "overview-item";
                div.innerHTML = `<strong>${set.name}</strong><span>${formatNum(profitPerSet)} gp</span>`;
                div.onclick = () => {
                    document.getElementById(`set-${index}`).scrollIntoView({behavior: "smooth"});
                };
                overviewEl.appendChild(div);
            });
        }

        function createSetSections() {
            const container = document.getElementById("setsContainer");
            container.innerHTML = "";
            setsData.forEach((set, index) => {
                const setWrapper = document.createElement("div");
                setWrapper.className = "set-wrapper";
                setWrapper.id = `set-${index}`;
                setWrapper.innerHTML = `
                    <div class="set-title">${set.name} Set</div>
                    <div class="cards">
                        ${set.items.map(item => `
                            <div class="card">
                                <div class="item-label">
                                    <img class="item-icon" src="https://oldschool.runescape.wiki/images/${item.imgName}.png" alt="${item.name}">
                                    ${item.name}
                                </div>
                                <div id="${item.id}">Loading...</div>
                            </div>`).join("")}
                        <div class="card total">
                            <div class="item-label">
                       
                                Total Pieces Cost:
                            </div>
                            <span id="total-${index}">Loading...</span>
                        </div>
                        <div class="card total">
                            <div class="item-label">
                                <img class="item-icon" src="https://oldschool.runescape.wiki/images/${set.setImgName}.png" alt="${set.name}">
                                Set Price:
                            </div>
                            <span id="setPrice-${index}">Loading...</span>
                        </div>
                    </div>
                    <div class="profit-box" id="profit-${index}">Loading...</div>
                    <div>
                        <label>Number of Sets: </label>
                        <input type="number" id="numSets-${index}" value="1" min="1">
                        <button onclick="updateProfit(${index})">Refresh</button>
                    </div>
                `;
                container.appendChild(setWrapper);
            });
        }

        async function fetchPrices() {
            try {
                const response = await fetch("https://corsproxy.io/?https://prices.runescape.wiki/api/v1/osrs/latest");
                latestData = await response.json();

                setsData.forEach((set, index) => {
                    let piecesTotal = 0;
                    set.items.forEach(item => {
                        const price = latestData.data[item.id].low;
                        document.getElementById(item.id).innerText = formatNum(price);
                        piecesTotal += price;
                    });

                    document.getElementById(`total-${index}`).innerText = formatNum(piecesTotal);
                    document.getElementById(`setPrice-${index}`).innerText = formatNum(latestData.data[set.setId].high);

                    updateProfit(index);
                });

                createOverview();
            } catch (err) {
                console.error(err);
            }
        }

        function calculateProfit(set) {
            let piecesTotal = set.items.reduce((sum, item) => sum + latestData.data[item.id].low, 0);
            const setSell = latestData.data[set.setId].high;
            const setSellAfterTax = setSell * 0.98;
            const profit = setSellAfterTax - piecesTotal;
            const roi = (profit / piecesTotal * 100).toFixed(2);
            return {profit, roi, cost: piecesTotal};
        }

        function updateProfit(index) {
            const set = setsData[index];
            const numSets = parseInt(document.getElementById(`numSets-${index}`).value);
            const {profit, roi} = calculateProfit(set);
            document.getElementById(`profit-${index}`).innerHTML =
                `Profit per set (after 2% tax): <span>${formatNum(profit)} gp</span><br>` +
                `Total profit for ${numSets} set(s): <span>${formatNum(profit*numSets)} gp</span><br>` +
                `ROI per set: <span>${roi}%</span>`;
        }

        function sortSets(criteria) {
            setsData.sort((a, b) => {
                const valA = calculateProfit(a)[criteria === 'profit' ? 'profit' : criteria === 'roi' ? 'roi' : 'cost'];
                const valB = calculateProfit(b)[criteria === 'profit' ? 'profit' : criteria === 'roi' ? 'roi' : 'cost'];
                return valB - valA;
            });
            createSetSections();
            fetchPrices();
        }

        document.getElementById("sortSelect").addEventListener("change", (e) => {
            sortSets(e.target.value);
        });

        // Initialize
        createSetSections();
        fetchPrices();
        setInterval(fetchPrices, 60000);
    </script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MZKESVVFTT"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-MZKESVVFTT');
    </script>
</body>
</html>
