<!DOCTYPE html>
<html>
<head>
    <title>OSRS Flipping Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
body {
    background-color: #121212;
    color: #e0e0e0;
    font-family: 'Roboto', sans-serif;
    margin: 0;
    padding: 20px;
}

h1 {
    text-align: center;
    margin-bottom: 20px;
    color: #ffffff;
    font-size: 3rem;
}

.container {
    max-width: 900px;
    width: 90%;
    margin: 0 auto;
}

.cards {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 20px;
}

.card {
    background: #1e1e1e;
    padding: 20px 15px; /* slightly smaller padding for tighter layout */
    border-radius: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    font-size: 1.8rem;
}

.card.total {
    font-weight: bold;
    font-size: 2rem;
}

.profit-box {
    background: #1e1e1e;
    border-radius: 10px;
    padding: 25px 15px; /* slightly tighter */
    text-align: center;
    font-size: 1.9rem;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
}

.profit-box span {
    display: block;
    font-size: 2.5rem;
    font-weight: bold;
}

.profit-positive span {
    color: #00e676;
}

.profit-negative span {
    color: #ff3d00;
}

input[type="number"] {
    width: 80px;
    padding: 8px;
    border-radius: 5px;
    border: none;
    margin-left: 10px;
    text-align: center;
    font-size: 1.6rem;
}

label {
    font-weight: bold;
    font-size: 1.6rem;
}

button {
    padding: 8px 12px;
    margin-left: 10px;
    border-radius: 5px;
    border: none;
    background-color: #00e676;
    color: #000;
    font-weight: bold;
    cursor: pointer;
    font-size: 1.6rem;
    transition: background-color 0.2s;
}

button:hover {
    background-color: #00c853;
}

.item-icon {
    width: 60px;
    height: 60px;
    margin-right: 10px; /* reduced gap */
    image-rendering: pixelated;
    transition: transform 0.2s, filter 0.2s;
}

.item-label {
    display: flex;
    align-items: center;
    font-size: 1.6rem;
    flex: 1; /* allows text to use more space */
}

.card div:last-child {
    margin-left: 10px; /* keep price closer to item name */
    white-space: nowrap; /* prevent wrapping */
}

footer {
    text-align: center;
    margin-top: 20px;
    color: #888;
    font-size: 18px;
}

/* Mobile adjustments */
@media (max-width: 600px) {
    .container {
        width: 95%;
    }
    .card {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
        font-size: 2rem;
        padding: 18px 12px; /* adjusted for mobile */
    }
    .item-label {
        font-size: 2rem;
    }
    .item-icon {
        width: 70px;
        height: 70px;
    }
    .profit-box {
        font-size: 2.1rem;
        padding: 22px 12px;
    }
    .profit-box span {
        font-size: 2.8rem;
    }
    input[type="number"] {
        width: 90px;
        font-size: 1.8rem;
    }
    button {
        font-size: 1.8rem;
        padding: 10px 15px;
    }
}
</style>




</head>
<body>
    <h1>OSRS Flipping Dashboard</h1>
    <div class="container">
        <div class="cards">
            <div class="card">
                <div class="item-label">
                    <img id="helmIcon" src="" alt="Helm" class="item-icon">
                    Helm
                </div>
                <div id="helmPrice">Loading...</div>
            </div>
            <div class="card">
                <div class="item-label">
                    <img id="cuirassIcon" src="" alt="Cuirass" class="item-icon">
                    Cuirass
                </div>
                <div id="cuirassPrice">Loading...</div>
            </div>
            <div class="card">
                <div class="item-label">
                    <img id="chaussesIcon" src="" alt="Chausses" class="item-icon">
                    Chausses
                </div>
                <div id="chaussesPrice">Loading...</div>
            </div>
            <div class="card total">
                Total Pieces Cost: <span id="piecesTotal">Loading...</span>
            </div>
            <div class="card">
                <div class="item-label">
                    <img id="setIcon" src="" alt="Sunfire Set" class="item-icon">
                    Sunfire Fanatic Set
                </div>
                <div id="setPrice">Loading...</div>
            </div>
        </div>

        <div>
            <label>Number of Sets: </label>
            <input type="number" id="numSets" value="1" min="1">
            <button id="refreshBtn">Refresh</button>
        </div>

        <div id="result" class="profit-box">Refreshing prices...</div>
    </div>

    <footer>Powered by Norxonics</footer>

    <script>
        let latestData = {};
        let prevPrices = { helm: 0, cuirass: 0, chausses: 0, set: 0 };

        const helmID = "28933";
        const cuirassID = "28936";
        const chaussesID = "28939";
        const setID = "29424";

        function formatNum(num) {
            return num.toLocaleString();
        }

        function setIconWithFlash(imgId, itemName, prevPrice, newPrice) {
            const img = document.getElementById(imgId);
            const urlName = itemName.replace(/ /g, "_");
            img.src = `https://oldschool.runescape.wiki/images/${urlName}.png`;

            if (prevPrice && newPrice !== prevPrice) {
                img.style.transform = "scale(1.2)";
                img.style.filter = newPrice > prevPrice ? "drop-shadow(0 0 10px #00e676)" : "drop-shadow(0 0 10px #ff3d00)";
                setTimeout(() => {
                    img.style.transform = "scale(1)";
                    img.style.filter = "none";
                }, 300);
            }
        }

async function fetchPrices() {
    document.getElementById("helmPrice").innerText = "Loading...";
    document.getElementById("cuirassPrice").innerText = "Loading...";
    document.getElementById("chaussesPrice").innerText = "Loading...";
    document.getElementById("piecesTotal").innerText = "Loading...";
    document.getElementById("setPrice").innerText = "Loading...";
    const resultEl = document.getElementById("result");
    resultEl.innerText = "Refreshing prices...";
    resultEl.className = "profit-box";

    try {
        const response = await fetch("https://corsproxy.io/?https://prices.runescape.wiki/api/v1/osrs/latest");
        if (!response.ok) {
            resultEl.innerText = "Error fetching data: " + response.status;
            resultEl.className = "profit-box profit-negative";
            return;
        }

        latestData = await response.json();

        const helmBuy = latestData.data[helmID].low;
        const cuirassBuy = latestData.data[cuirassID].low;
        const chaussesBuy = latestData.data[chaussesID].low;
        const piecesTotal = helmBuy + cuirassBuy + chaussesBuy;

        const setSell = latestData.data[setID].high;
        const setSellAfterTax = setSell * 0.98;

        // Set icons with flashing
        setIconWithFlash("helmIcon", "Sunfire fanatic helm", prevPrices.helm, helmBuy);
        prevPrices.helm = helmBuy;

        setIconWithFlash("cuirassIcon", "Sunfire fanatic cuirass", prevPrices.cuirass, cuirassBuy);
        prevPrices.cuirass = cuirassBuy;

        setIconWithFlash("chaussesIcon", "Sunfire fanatic chausses", prevPrices.chausses, chaussesBuy);
        prevPrices.chausses = chaussesBuy;

        setIconWithFlash("setIcon", "Sunfire fanatic armour set", prevPrices.set, setSell);
        prevPrices.set = setSell;

        // Display prices (set is BEFORE tax)
        document.getElementById("helmPrice").innerText = formatNum(helmBuy);
        document.getElementById("cuirassPrice").innerText = formatNum(cuirassBuy);
        document.getElementById("chaussesPrice").innerText = formatNum(chaussesBuy);
        document.getElementById("piecesTotal").innerText = formatNum(piecesTotal);
        document.getElementById("setPrice").innerText = formatNum(setSell);

        // Calculate profit
        calculateProfit();

    } catch (error) {
        resultEl.innerText = "Error fetching data: " + error;
        resultEl.className = "profit-box profit-negative";
    }
}

function calculateProfit() {
    const numSets = parseInt(document.getElementById("numSets").value);
    const helmBuy = latestData.data[helmID].low;
    const cuirassBuy = latestData.data[cuirassID].low;
    const chaussesBuy = latestData.data[chaussesID].low;
    const piecesTotal = helmBuy + cuirassBuy + chaussesBuy;

    const setSell = latestData.data[setID].high;
    const setSellAfterTax = setSell * 0.98;

    const profitPerSet = setSellAfterTax - piecesTotal;
    const totalProfit = profitPerSet * numSets;
    const roiPercent = ((profitPerSet / piecesTotal) * 100).toFixed(2);

    const resultEl = document.getElementById("result");
    resultEl.innerHTML =
        `Profit per set (after 2% tax): <span>${formatNum(profitPerSet)} gp</span><br>` +
        `Total profit for ${numSets} set(s): <span>${formatNum(totalProfit)} gp</span><br>` +
        `ROI per set: <span>${roiPercent}%</span>`;
    resultEl.className = profitPerSet >= 0 ? "profit-box profit-positive" : "profit-box profit-negative";
}


        document.getElementById("refreshBtn").addEventListener("click", calculateProfit);

        // Initial fetch and auto-refresh every 60 seconds
        fetchPrices();
        setInterval(fetchPrices, 60000);
    </script>
</body>
</html>
